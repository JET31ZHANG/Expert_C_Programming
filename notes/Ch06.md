# 运动的诗章：运行时数据结构
## a.out 及其传说
## 段

```c
% echo;
echo "text data total";
size a.out
/*
    text 
*/
```

```c
        char pear[40];
static double peach;
        int mango = 13;
static long melon = 2001;
main() {
    int i = 3, j, *ip;
    ip = malloc (sizeof(i));
    pear[5] = i;
    peach = 2.0 * mango;
}
```

## 操作系统在 a.out 文件里干了些什么
## C 语言运行时系统在 a.out 里干了些什么
## 当函数被调用时发生了什么：过程活动记录
## auto 和 static 关键字

```c
char * favorite_fruit () {
    char deciduous [] = "apple";
    return deciduous;
}
```

## 控制线程
## setjmp 和 longjmp 
```c
#include <setjmp.h>
jmp_buf buf;
banana() {
    printf("in banana()\n");
    longjmp(buf, 1);
    /*NOTREACHED*/
    printf("you'll never see this, because I longjmp'd");
}

main()
{
    if (setjmp(buf))
        printf("back in main\n");
    else {
        printf("first time through\n");
        banana();
    }
}
```

```c
switch (setjmp(jbuf)) {
    case 0:
        apple  = *suspicious;
        break;
    case 1:
        printf("suspicious is indeed a bad pointer\n");
        break;
    default:
        die("unexpected value returned by setjmp");
}
```
## UNIX 中的堆栈段

## MS-DOS 中的堆栈段

## 有用的  C 语言工具

## 轻松一下：CMU的编程难题

## 只适用于高级学员阅读的材料
可以把汇编代码嵌入到 C 代码中。通常只用于深入操作系统核心非常依赖机器的任务。（如，设置某个特别的寄存器，将系统的状态从管理员模式转变为用户模式。）

```c
/* 把一条 no-op （或其他指令）插入到使用 SunPro SPARCompiler 的 C 函数中 */
banana() 
{
    asm("nop");
}

/* 下面是如何在 PC 中使用 Microsoft C 嵌入汇编语言指令 */
__asm mov ah, 2
__asm mov dl, 43h

/* 
    可以在汇编代码前冠以关键字 "__asm"，
    也可以使用该关键字一次，把所有的汇编代码放入一对花括号内。
*/
__asm {
    mov ah, 2
    mov dl, 43h
    int 21h
}
```